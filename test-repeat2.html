<!DOCTYPE html>
<html lang="zh-TW">
<head>
 <meta charset="UTF-8">
 <title>YouTube å–®æ›²å¾ªç’°æ’­æ”¾å™¨</title>
 <style>
  body {
   font-family: sans-serif;
   background-color: #121212;
   color: #e0e0e0;
   text-align: center;
   padding: 30px;
  }
  h1 {
   color: #ffffff;
  }
  textarea {
   background-color: #1e1e1e;
   color: #e0e0e0;
   border: 1px solid #333;
   font-size: 16px;
   padding: 10px;
   margin: 10px;
   width: 80%;
   resize: none; /* ç§»é™¤å‚ç›´ç¸®æ”¾ */
  }
  button {
   background-color: #333;
   color: #fff;
   border: 1px solid #555;
   border-radius: 6px;
   padding: 10px 15px;
   margin: 8px;
   cursor: pointer;
   transition: background-color 0.2s;
  }
  button:hover {
   background-color: #555;
  }
  iframe {
   margin-top: 20px;
   width: 720px;
   height: 405px;
   border: 2px solid #444;
   background-color: black;
  }
  #currentTitle {
   font-size: 20px;
   font-weight: bold;
   margin-top: 20px;
   color: #ffffff;
  }
 </style>
</head>
<body>

 <h1>YouTube å–®æ›²å¾ªç’°æ’­æ”¾å™¨</h1>
 <p>è«‹è¼¸å…¥ YouTube å½±ç‰‡é€£çµ</p>

 <textarea id="youtubeUrl" rows="1" cols="60" placeholder="è«‹è¼¸å…¥ YouTube å½±ç‰‡é€£çµ"></textarea><br>
 <button onclick="loadVideo()">é–‹å§‹æ’­æ”¾</button>
 <button onclick="toggleLoop()">ğŸ” å¾ªç’°æ’­æ”¾ï¼š<span id="loopStatus">é—œ</span></button>

 <div id="currentTitle">ç›®å‰æ’­æ”¾ï¼šå°šæœªé–‹å§‹</div>

 <iframe id="youtubePlayer" allow="autoplay" allowfullscreen></iframe>

 <script>
  let videoId = null;
  let player;
  let loopEnabled = false;

  function extractVideoID(url) {
   const regex = /(?:youtube\.com\/.*v=|youtu\.be\/)([^&?/]+)/;
   const match = url.match(regex);
   return match ? match[1] : null;
  }

  function loadVideo() {
   const url = document.getElementById("youtubeUrl").value.trim();
   videoId = extractVideoID(url);

   if (!videoId) {
    alert("è«‹è¼¸å…¥æœ‰æ•ˆçš„ YouTube å½±ç‰‡é€£çµï¼");
    return;
   }

   if (player) {
    player.loadVideoById(videoId);
   } else {
    player = new YT.Player('youtubePlayer', {
     height: '405',
     width: '720',
     videoId: videoId,
     events: {
      'onReady': onPlayerReady,
      'onStateChange': onPlayerStateChange
     }
    });
   }
   fetchVideoTitle(videoId);
  }

  function onPlayerReady(event) {
   // æ’­æ”¾å™¨æº–å‚™å°±ç·’å¾Œå¯ä»¥é€²è¡Œæ“ä½œï¼Œä¾‹å¦‚è‡ªå‹•æ’­æ”¾
  }

  function onPlayerStateChange(event) {
   if (event.data === YT.PlayerState.ENDED) {
    if (loopEnabled) {
     event.target.playVideo(); // å¾ªç’°æ’­æ”¾
    }
   }
  }

  function toggleLoop() {
   loopEnabled = !loopEnabled;
   document.getElementById("loopStatus").textContent = loopEnabled ? "é–‹" : "é—œ";
  }

  function fetchVideoTitle(videoID) {
   fetch(`https://noembed.com/embed?url=https://www.youtube.com/watch?v=${videoID}`)
    .then(res => res.json())
    .then(data => {
     const title = data.title || "æœªçŸ¥æ¨™é¡Œ";
     document.getElementById("currentTitle").textContent = `ç›®å‰æ’­æ”¾ï¼š${title}`;
    })
    .catch(() => {
     document.getElementById("currentTitle").textContent = `ç›®å‰æ’­æ”¾ï¼š${videoID}`;
    });
  }

  // è¼‰å…¥ YouTube IFrame Player API
  var tag = document.createElement('script');
  tag.src = "https://www.youtube.com/iframe_api";
  var firstScriptTag = document.getElementsByTagName('script')[0];
  firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);

  // onYouTubeIframeAPIReady æœƒåœ¨ API ä¸‹è¼‰å®Œæˆå¾Œè¢«å‘¼å«
  function onYouTubeIframeAPIReady() {
   // é€™è£¡ player ç‰©ä»¶æœƒåœ¨ loadVideo() å‡½å¼ä¸­è¢«å»ºç«‹
  }
 </script>

</body>
</html>