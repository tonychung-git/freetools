<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>YouTube Playlist Player</title>
  <style>
    body {
      background-color: #121212;
      color: #ffffff;
      font-family: Arial, sans-serif;
      margin: 0;
      padding: 0;
    }
    .container {
      max-width: 800px;
      margin: 20px auto;
      padding: 20px;
    }
    input, button, select {
      background-color: #333;
      color: #fff;
      border: 1px solid #444;
      padding: 8px;
      margin: 5px;
    }
    iframe {
      width: 100%;
      height: 450px;
      margin-top: 10px;
      border: none;
    }
    .controls {
      margin-top: 10px;
    }
    .video-title {
      font-size: 18px;
      margin-top: 10px;
    }
    label {
      margin-right: 10px;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>YouTube Playlist Player</h1>
    <input type="text" id="videoInput" placeholder="Enter YouTube video URL" />
    <button onclick="addVideo()">Add Video</button>
    <br>
    <label><input type="checkbox" id="loopPlaylist" /> Loop Playlist</label>
    <label><input type="checkbox" id="loopSingle" /> Loop Single Video</label>

    <div class="controls">
      <button onclick="prevVideo()">Previous</button>
      <button onclick="nextVideo()">Next</button>
    </div>

    <iframe id="player" allow="autoplay"></iframe>
    <div class="video-title" id="videoTitle"></div>

    <ul id="playlist"></ul>
  </div>

  <script>
    let playlist = [];
    let currentIndex = 0;
    let iframe = document.getElementById("player");
    let titleDiv = document.getElementById("videoTitle");
    let loopPlaylistCheckbox = document.getElementById("loopPlaylist");
    let loopSingleCheckbox = document.getElementById("loopSingle");

    function addVideo() {
      const input = document.getElementById("videoInput");
      const url = input.value;
      const videoID = extractVideoID(url);
      if (videoID) {
        fetch(`https://noembed.com/embed?url=https://www.youtube.com/watch?v=${videoID}`)
          .then(response => response.json())
          .then(data => {
            playlist.push({ id: videoID, title: data.title });
            updatePlaylistUI();
            if (playlist.length === 1) playVideo(0);
          });
      }
      input.value = "";
    }

    function extractVideoID(url) {
      const match = url.match(/[?&]v=([^&]+)/) || url.match(/youtu\.be\/([^?]+)/);
      return match ? match[1] : null;
    }

    function playVideo(index) {
      if (index >= 0 && index < playlist.length) {
        currentIndex = index;
        const videoID = playlist[currentIndex].id;
        const loopSingle = loopSingleCheckbox.checked;
        const loopParam = loopSingle ? `&loop=1&playlist=${videoID}` : "";
        iframe.src = `https://www.youtube.com/embed/${videoID}?autoplay=1${loopParam}&enablejsapi=1&rel=0`;
        titleDiv.textContent = playlist[currentIndex].title;
      }
    }

    function prevVideo() {
      if (currentIndex > 0) {
        playVideo(currentIndex - 1);
      }
    }

    function nextVideo() {
      if (currentIndex < playlist.length - 1) {
        playVideo(currentIndex + 1);
      } else if (loopPlaylistCheckbox.checked) {
        playVideo(0);
      }
    }

    function updatePlaylistUI() {
      const ul = document.getElementById("playlist");
      ul.innerHTML = "";
      playlist.forEach((video, index) => {
        const li = document.createElement("li");
        li.textContent = video.title;
        li.style.cursor = "pointer";
        li.onclick = () => playVideo(index);
        const delBtn = document.createElement("button");
        delBtn.textContent = "Remove";
        delBtn.onclick = (e) => {
          e.stopPropagation();
          playlist.splice(index, 1);
          if (index === currentIndex && playlist.length > 0) {
            currentIndex = 0;
            playVideo(0);
          } else if (playlist.length === 0) {
            iframe.src = "";
            titleDiv.textContent = "";
          } else if (index < currentIndex) {
            currentIndex--;
          }
          updatePlaylistUI();
        };
        li.appendChild(delBtn);
        ul.appendChild(li);
      });
    }

    // Listen for end of video (requires YouTube API)
    window.onYouTubeIframeAPIReady = function() {
      new YT.Player('player', {
        events: {
          'onStateChange': function(event) {
            if (event.data === YT.PlayerState.ENDED) {
              if (!loopSingleCheckbox.checked) nextVideo();
            }
          }
        }
      });
    };

    const tag = document.createElement('script');
    tag.src = "https://www.youtube.com/iframe_api";
    document.body.appendChild(tag);
  </script>
</body>
</html>